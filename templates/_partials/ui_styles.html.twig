<style>
    @import url('https://rsms.me/inter/inter.css');

    :root {
        --font-base:
                'Inter',
                -apple-system,
                BlinkMacSystemFont,
                "SF Pro Text",
                "Segoe UI",
                Roboto,
                Helvetica,
                Arial,
                sans-serif;

        --bg: #1b263a;
        --card: #0f182bdb;
        --accent: #5865f2;
        --accent-600: #4752c4;
        --muted: #a9b5c9;
        --text: #e8edf5;
        --error: #ef4444;
        --ring: #3bcdf7aa;
    }

    /* ======== Baseline ======== */
    html { scrollbar-gutter: stable; }
    @supports not (scrollbar-gutter: stable) {
        html { overflow-y: scroll; }
    }

    body {
        background:
                radial-gradient(1200px 600px at 10% 10%, #24324b 0%, transparent 50%),
                radial-gradient(900px 500px at 90% 20%, #161f32 0%, transparent 40%),
                linear-gradient(180deg, var(--bg), #0b1321);
        min-height: 100dvh;
        font-family: var(--font-base), sans-serif;
        color: var(--text);
    }

    /* ðŸ”¹ Belangrijk: alles, vooral knoppen en inputs, dezelfde font-family laten erven */
    button,
    input,
    select,
    textarea {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.2;
    }

    /* ======== Layout en containers ======== */
    .wrap {
        min-height: 100dvh;
        display: grid;
        align-content: start;
        gap: 24px;
        padding: 24px;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        margin-top: 8px;
    }

    .title { font-size: 22px; letter-spacing: .2px; margin: 0; }
    .subtitle { color: var(--muted); font-size: 14px; margin: 4px 0 0; }

    .card {
        width: 100%;
        background: linear-gradient(180deg, #0b1224aa, #0b1224f2);
        border: 1px solid #1f2937;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 10px 30px #0008, inset 0 1px 0 #ffffff0a;
        backdrop-filter: blur(10px);
        animation: rise .3s ease-out;
    }

    @keyframes rise {
        from { opacity: 0; transform: translateY(6px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    /* ======== Grid & form structuur ======== */
    .grid { display: grid; gap: 16px; }
    .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        align-items: start;
    }
    .grid-2 > * { min-width: 0; } /* voorkomt overflow bij brede elementen */

    .form-row { display: grid; gap: 8px; margin: 10px 0; }
    .label { font-size: 13px; color: #cbd5e1; }

    .section { margin-top: 18px; }
    .section-title { font-size: 16px; font-weight: 600; margin: 0 0 10px; color: #dce6f9; }

    /* ===========================
   Logo styling
   =========================== */
    .header-logo {
        height: 64px;
        width: auto;
        border-radius: 12px;     /* afgeronde hoeken */
        display: block;
    }

    /* ===========================
       Buttons: algemene hover
       =========================== */
    .btn:hover,
    .btn.secondary:hover,
    .btn-danger:hover {
        cursor: pointer;
        filter: brightness(1.1);
    }

    /* ===========================
       Disabled buttons
       =========================== */
    button[disabled],
    button[disabled]:hover {
        opacity: 0.45;            /* lichter */
        cursor: not-allowed;      /* geen pointer bij disabled */
        filter: none !important;  /* geen hover-effect */
    }


    /* ======== Buttons ======== */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 14px;
        border-radius: 12px;
        border: 0;
        background: linear-gradient(180deg, var(--accent), var(--accent-600));
        color: #fff;
        font-weight: 600;
        text-decoration: none;
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }

    .btn.secondary {
        background: #0b1224;
        border: 1px solid #243148;
        color: var(--text);
    }
    .btn-danger {
        background: #7f1d1d;
        border: 1px solid #ef4444;
        color: #ffb4b4;
    }
    .btn-danger:hover { filter: brightness(1.05); }
    .btn-danger:active { transform: translateY(1px); }

    .btn-sm {
        padding: 6px 10px;
        font-size: 12px;
        line-height: 1;
        border-radius: 8px;
    }

    /* ðŸ”¹ EÃ©n consistente mini-knop stijl */
    .btn-mini {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 4px 10px;
        font-size: 13px;
        line-height: 1.1;
        border-radius: 8px;
        border: 1px solid #243148;
        background: #0b1224;
        color: var(--text);
        cursor: pointer;
    }
    .btn-mini.secondary {
        background: #0b1224;
        border-color: #243148;
    }
    .btn-mini.danger {
        background: #7f1d1d;
        border-color: #ef4444;
        color: #ffb4b4;
    }

    .btn-ghost {
        background: #0b1224;
        border: 1px solid #243148;
        color: var(--text);
        border-radius: 10px;
        padding: 8px 10px;
    }
    .btn-ghost.danger {
        background: #7f1d1d;
        border-color: #ef4444;
        color: #ff8585;
    }

    /* ======== Inputs / select / textarea ======== */
    .input,
    .select,
    .textarea,
    input[type="file"],
    select,
    textarea {
        background: #0b1224;
        border: 1px solid #243148;
        border-radius: 12px;
        color: var(--text);
        padding: 12px 14px;
        outline: none;
        transition: border-color .15s, box-shadow .15s, background .2s;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }
    .input:focus,
    .select:focus,
    .textarea:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 4px var(--ring);
        background: #0e162e;
    }

    /* ======== Chips / assets ======== */
    .chips {
        display: flex;
        flex-direction: column;   /* elke chip op zâ€™n eigen regel */
        gap: 8px;
        min-width: 0;
    }

    .chip {
        display: flex;
        justify-content: space-between; /* links: titel, rechts: knoppen */
        align-items: center;
        padding: 8px 12px;
        border-radius: 10px;
        background: #0b1224;
        border: 1px solid #243148;
        color: var(--text);
        font-size: 13px;
        width: 100%;                 /* ðŸ”¹ zo breed als de container */
        max-width: 100%;
        box-sizing: border-box;
        white-space: nowrap;         /* alles op Ã©Ã©n regel */
    }

    .chip-main {
        display: flex;
        align-items: center;
        gap: 6px;
        min-width: 0;
    }

    .chip-name {
        overflow: hidden;
        text-overflow: ellipsis;     /* lange bestandsnamen afkappen */
    }

    .chip-meta {
        flex-shrink: 0;
    }

    .chip-actions {
        display: inline-flex;
        gap: 6px;
        margin-left: 16px;
        flex-shrink: 0;              /* knoppen niet laten krimpen */
    }

    .chip a { color: #a5b4fc; text-decoration: none; }

    .chip .btn-mini {
        font-size: 12px;
        padding: 6px 8px;
        border-radius: 8px;
        border: 0;
        background: #18243c;
        cursor: pointer;
    }

    .chip .btn-mini.danger {
        background: #7f1d1d;
        border: 1px solid #ef4444;
    }

    /* ======== Tracks ======== */
    .tracks { display: grid; gap: 12px; margin-top: 12px;}
    /* ======== Tracks ======== */
    /* ======== Tracks ======== */
    .track-card {
        /* A visible â€œtrack slabâ€ from top to bottom */
        background:
            /* soft top glow */
                radial-gradient(1100px 380px at 12% 0%, rgba(88, 101, 242, 0.28), transparent 58%),
                    /* subtle wash through the whole card (this is the missing bit) */
                linear-gradient(180deg, rgba(88, 101, 242, 0.10), rgba(88, 101, 242, 0.04)),
                    /* base */
                linear-gradient(180deg, #0f182bcc, #0f182bf2);

        border: 1px solid #1f2937;
        border-radius: 12px;
        padding: 16px;
    }

    /* === Instrument Parts UI === */
    .instrument-part {
        /* Make parts clearly different from the surrounding track area */
        background:
            /* a crisp-ish highlight so it doesn't disappear */
                radial-gradient(900px 320px at 10% 0%, rgba(59, 205, 247, 0.22), transparent 60%),
                    /* overall tint wash (so the whole part reads as â€œits own cardâ€) */
                linear-gradient(180deg, rgba(59, 205, 247, 0.10), rgba(59, 205, 247, 0.03)),
                    /* base slightly different from #0b1224 to create separation */
                linear-gradient(180deg, #0a1327, #070f1f);

        border: 1px solid #243148;
        border-radius: 10px;
        padding: 12px;
        display: grid;
        gap: 10px;
        margin-bottom: 8px;
    }

    .track-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    .track-title { font-weight: 600; }
    .track-actions { display: flex; gap: 8px; }
    .track-actions .btn-mini {
        font-size: 12px;
        padding: 6px 8px;
        border-radius: 8px;
        border: 0;
        background: #18243c;
        color: #e8edf5;
        cursor: pointer;
        line-height: 1.1;
    }
    .track-actions .btn-mini.danger {
        background: #7f1d1d;
        border: 1px solid #ef4444;
        color: #ffb4b4;
    }
    .subsection .label { display: block; font-size: 0.95rem; margin-bottom: 6px; opacity: 0.9; }
    .collection-item { display: flex; gap: 8px; align-items: flex-start; margin-bottom: 8px; }

    /* ======== Forms & tables ======== */
    .error-box {
        background: #7f1d1d;
        border: 1px solid var(--error);
        color: #fee2e2;
        padding: 10px 12px;
        border-radius: 12px;
        font-size: 14px;
    }
    .table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }
    .table th, .table td {
        padding: 10px 12px;
        border-bottom: 1px solid #243148;
        vertical-align: top;
    }
    .table th { color: #cbd5e1; text-align: left; font-weight: 600; }
    .table code { color: #a5b4fc; font-size: .9em; }

    .actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .actions-inline { display: flex; flex-wrap: nowrap; gap: 8px; }
    .form-actions { display: flex; gap: 10px; justify-content: flex-start; margin-top: 16px; }

    .muted { color: var(--muted); }
    .subtle { color: var(--muted); font-size: 13px; }

    /* ======== LevelDurations UI ======== */
    .ld-tiles {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 8px 0 6px;
    }
    .ld-row {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 20px;
        width: 100%;
    }

    .ld-actions {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .ld-track-add {
        margin-left: auto; /* duwt de knop helemaal rechts */
        display: flex;
        align-items: center;
    }
    .ld-square {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        border: 1px solid #243148;
        background: #0b1224;
        color: var(--text);
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        user-select: none;
    }
    .ld-square.on {
        border-color: var(--accent);
        box-shadow: 0 0 0 4px var(--ring);
        background: linear-gradient(180deg, var(--accent), var(--accent-600));
        color: #fff;
    }
    .ld-hidden { display: none; }
    .ld-square.locked {
        cursor: default;
        pointer-events: none;
        opacity: 0.95;
    }

    /* ======== Responsiveness & overflow fixes ======== */
    .grid-2 > * { min-width: 0; }
    .form-row, .section .grid > * { min-width: 0; }
    input[type="file"] { display: block; width: 100%; }

    /* Table / content safety */
    * { box-sizing: border-box; }

    /* MIDI Loop editor */
    .loop-editor {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 4px;
    }
    .loop-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    .loop-chip {
        padding: 4px 8px;
        border-radius: 12px;
        border: 1px solid rgba(0,0,0,0.1);
        font-size: 13px;
        background: #5865f2;
        white-space: nowrap;
    }
    .loop-chip-colored {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 999px;
        font-size: 12px;
        margin-right: 6px;
        margin-bottom: 4px;
    }
    .loop-empty {
        font-size: 13px;
        color: #999;
    }
    .loop-actions {
        display: flex;
        gap: 6px;
    }
    .loop-hidden-input {
        display: none; /* we laten alleen de chips zien */
    }
    .loop-base-wrapper {
        margin-top: 8px;
    }

    .loop-base-header {
        margin-bottom: 4px;
    }

    .loop-base-controls {
        display: flex;
        align-items: center;
        gap: 8px;             /* ruimte tussen input en knoppen */
    }

    .loop-base-controls .js-loop-base-input {
        flex: 1 1 auto;       /* input neemt alle beschikbare breedte */
        min-width: 0;
        max-width: 47%;
    }

    .loop-base-controls .btn-mini {
        flex: 0 0 auto;       /* knoppen blijven compact */
        white-space: nowrap;
    }

    /* ===========================
   MIDI panel redesign
   =========================== */

    .midi-panel { display: grid; gap: 10px; }
    .midi-label { margin-bottom: 2px; }

    .midi-select {
        width: 100%;
    }

    /* Header: context links, meta rechts */
    .midi-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 12px;
        margin-top: 4px;
    }

    .midi-context {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        align-items: center;
    }

    .midi-timesig,
    .midi-bars {
        display: flex;
        align-items: baseline;
        gap: 6px;
    }

    .midi-context-label {
        font-size: 12px;
        color: var(--muted);
        letter-spacing: .2px;
    }

    .midi-context-value {
        font-size: 16px;
        font-weight: 700;
        color: var(--text);
    }

    /* Duur/BPM klein rechtsboven */
    .midi-meta {
        font-size: 12px;
        color: var(--muted);
        display: inline-flex;
        gap: 6px;
        white-space: nowrap;
        margin-top: 2px;
    }

    /* Rhythm card: compact container */
    .midi-rhythm-card {
        background: #0b1224;
        border: 1px solid #243148;
        border-radius: 12px;
        padding: 10px 12px;
        display: grid;
        gap: 8px;
    }

    /* Basismaten rij: titel + controls */
    .loop-base-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        flex-wrap: wrap;
    }

    .loop-base-title {
        display: flex;
        align-items: baseline;
        gap: 8px;
        min-width: 0;
    }

    .loop-base-hint {
        font-size: 12px;
    }

    /* Controls netjes compact */
    .loop-base-controls {
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .loop-base-input {
        width: 96px;         /* compact maar leesbaar */
        max-width: 120px;
        text-align: center;
        padding: 8px 10px;
    }

    /* Loops chips compact */
    .loop-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 2px;
    }

    .loop-chip {
        padding: 4px 8px;
        border-radius: 999px;
        font-size: 12px;
        background: #5865f2;
        white-space: nowrap;
    }

    /* Acties onder chips */
    .loop-actions {
        display: inline-flex;
        gap: 6px;
        flex-wrap: wrap;
    }

    /* Mobile: meta onder context */
    @media (max-width: 700px) {
        .midi-header {
            flex-direction: column;
            align-items: flex-start;
        }
        .midi-meta {
            margin-top: 0;
        }
    }

    /* ===== Effects UI ===== */
    .effects-panel {
        display: grid;
        margin-top: 16px; /* optioneel, voor wat extra lucht t.o.v. de rest */
    }

    .effects-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .effects-header .label {
        margin-bottom: 0; /* label netjes gecentreerd met de knop */
    }

    /* Optioneel: kleine tweak specifiek voor deze knop */
    .effects-add-btn {
        white-space: nowrap;
    }

    .effects { display: grid; gap: 8px; }

    .effect-card {
        background: #0b1224;
        border: 1px solid #243148;
        border-radius: 10px;
        padding: 10px;
        display: grid;
        gap: 8px;
    }

    .effect-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }

    .effect-actions { display: inline-flex; gap: 6px; }

    .effect-json {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size: 12.5px;
        line-height: 1.35;
        height: 450px;
    }

    .wrap .form-actions{
        display:flex;
        justify-content:flex-end;
        gap:8px;
        margin-top:12px;
    }

    /* === Instrument Parts UI === */

    .instrument-parts-panel {
        display: grid;
        margin-top: 16px;
    }

    .instrument-parts-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .instrument-parts-add-btn {
        white-space: nowrap;
    }

    .instrument-parts {
        display: grid;
        gap: 10px;
    }

    .instrument-part-grid {
        display: grid;
        /*grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);*/
        grid-template-columns: minmax(0, 1fr) minmax(0, 1.5fr);

        gap: 16px;
        align-items: flex-start;
        /*padding-left: 6px;*/
    }

    .instrument-part-target-col {
        min-width: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    /* Ã©Ã©n rij met 3 kolommen */
    .damper-extra-settings {
        margin-top: 4px;
    }

    .damper-row-3 {
        display: flex;
        gap: 8px;
    }

    .damper-field {
        flex: 1 1 0;
        min-width: 0;
    }

    .damper-field .label-small {
        display: block;
        margin-bottom: 4px;
        font-size: 12px;
        color: var(--muted);
    }

    .instrument-part-region,
    .part-effect-target {
        min-width: 0;
    }

    .part-effect-target select {
        width: 100%;
    }

    /* ======== Area of Interest UI ======== */
    .aoi-tiles {
        display: grid;
        gap: 8px;
        margin: 8px 0 6px;
    }

    .instrument-part-header-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 6px;
    }

    /* Labelsblok mag gewoon uitrekken */
    .instrument-part-header-row .instrument-parts-header {
        flex: 0.9 1.1 auto;
    }

    /* Knop compact rechtsboven */
    .instrument-part-remove {
        align-self: flex-start;
        white-space: nowrap;
    }

    /* Instrument parts layout: AOI links, target rechts */
    .instrument-parts-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 6px;
    }

    .instrument-parts-header .label {
        flex: 1;
    }

    /* Twee kolommen per instrument-part */
    .instrument-part-grid {
        display: grid;
        grid-template-columns: minmax(0, 1fr) minmax(0, 1.5fr);
        gap: 16px;
        align-items: flex-start;
    }

    .instrument-part-region,
    .part-effect-target {
        min-width: 0;
    }

    /* loopsToGrid */
    .instrument-part-region {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .loops-grid-label {
        margin-top: 10px;
    }

    .loops-tiles {
        display: grid;
        gap: 4px;
    }

    .loops-tiles.loops-disabled {
        opacity: 0.4;
    }

    /* ===========================
    Fixed bottom action bar
    =========================== */

    :root {
        --bottom-bar-h: 76px;   /* hoogte van de balk */
        --wrap-pad: 24px;       /* gelijk aan .wrap padding */
    }

    /* Geef pagina ruimte zodat bar niets overlapt */
    .wrap {
        padding-bottom: calc(var(--bottom-bar-h) + var(--wrap-pad) + 12px);
    }

    /* Fixed container, viewport-based */
    .bottom-bar {
        position: fixed;
        left: var(--wrap-pad);
        right: var(--wrap-pad);
        bottom: calc(var(--wrap-pad) + env(safe-area-inset-bottom));
        z-index: 999;
        pointer-events: none; /* alleen inner mag klikken */
    }

    /* De balk zelf (klikbaar) */
    .bottom-bar-inner {
        pointer-events: auto;

        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;

        background: linear-gradient(180deg, #0b1224f2, #0b1224);
        border: 1px solid #1f2937;
        border-radius: 14px;
        padding: 10px 12px;
        box-shadow: 0 -6px 18px #0009, inset 0 1px 0 #ffffff0a;
        backdrop-filter: blur(8px);

        min-height: var(--bottom-bar-h);
    }

    /* LINKS: flashes */
    .bottom-bar-flashes {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        min-width: 0;
    }

    /* Flash styling */
    .flash {
        padding: 6px 10px;
        border-radius: 10px;
        font-size: 13px;
        border: 1px solid transparent;
        background: #0b1224;
        white-space: nowrap;
    }

    .flash-success {
        border-color: #22c55e;
        color: #bbf7d0;
        background: #052e1a;
    }
    .flash-warning {
        border-color: #f59e0b;
        color: #fde68a;
        background: #2a1a04;
    }
    .flash-danger,
    .flash-error {
        border-color: #ef4444;
        color: #fecaca;
        background: #2a0b0b;
    }
    .flash-info {
        border-color: #3bcdf7;
        color: #cfefff;
        background: #06202a;
    }

    /* RECHTS: actions */
    .bottom-bar-actions {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        margin-left: auto;
        flex-shrink: 0;
    }

    /* published mooi inline */
    .bottom-bar-published .form-row { margin: 0; }
    .bottom-bar-published label {
        margin-right: 6px;
        font-size: 13px;
        color: var(--muted);
    }
    .bottom-bar-published input[type="checkbox"] {
        transform: translateY(1px);
    }

    /* responsive: stack flashes boven actions */
    @media (max-width: 700px) {
        :root { --wrap-pad: 12px; }

        .bottom-bar-inner {
            flex-direction: column;
            align-items: stretch;
            gap: 10px;
            min-height: unset;
        }

        .bottom-bar-actions {
            justify-content: flex-end;
            width: 100%;
        }

        .bottom-bar-flashes {
            width: 100%;
        }
    }

</style>
